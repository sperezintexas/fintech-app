---
description: Guidelines for formatting Slack messages & Block Kit in myInvestments
globs:
alwaysApply: true
---

# Slack Message & Block Kit Formatting Rules

## Core Goals
- Use **Block Kit JSON** for all user-facing alerts, reports, scanner results
- Maximize scannability, hierarchy, and actionable buttons
- Use minimal, strategic emojis
- Include risk indicators on recommendations when relevant

## Block Structure (preferred order)

1. **Header** â€” `header` block + emoji + short title (â‰¤40 chars)
2. **Stats** â€” `section` + `fields` (3-col layout) for key numbers
3. **Breakdown** â€” `fields` with bold strategy names + counts
4. **Recommendations** â€” `*ğŸ”¥ Key Recommendations*` â†’ one `section` per item
   - Format: `â€¢ *SYMBOL EXPIRY STRIKE TYPE* â€” *ACTION*` + brief reason
   - Add `accessory` button (`primary` or `danger`) with deep-link `url`
5. **Delivery** â€” `fields` for Sent / Failed / Skipped
6. **Actions** â€” `actions` block with 2â€“4 buttons (View Dashboard, Acknowledge, Snooze)
7. **Context** â€” subtle closing note

## Risk Indicators
Append one badge to recommendation text when meaningful:

- `ğŸ”´ High Risk` â€” urgent (deep loss, assignment imminent, high vol exposure)
- `ğŸŸ  Medium Risk` â€” monitor (near breakeven, elevated IV, short DTE)
- `ğŸŸ¢ Low Risk` â€” optional (stable, favorable position)

## Button Rules
- Use `url` for deep links (dashboard, position, action pages)
- `style: "danger"` for urgent/high-risk actions
- Descriptive text: "View TSLA", "Add Protection", "Close Position"
- Always set `action_id`

## Emoji Usage
Strategic & minimal:
- ğŸš¨ urgent alert
- ğŸ”¥ recommendations
- ğŸ“Š stats
- ğŸ“¤âŒâ© delivery status
- ğŸ“ˆ closing note

## Slack Block Kit Validation Checklist
Before finalizing Block Kit output, verify:

- Valid JSON structure (blocks array, correct types)
- No missing required fields (e.g. `text` in section/header, `elements` in actions)
- All `action_id` values are unique & descriptive
- URLs are real deep links (no placeholders)
- Button styles match urgency (`danger` for high-risk only)
- Total blocks â‰¤ 50 (Slack limit)
- Text lengths reasonable (avoid truncation on mobile)
- Risk badges used only when justified by metrics
- Emojis enhance (not clutter)

## Implementation (Unified Options Scanner)
- **File:** `src/lib/slack-templates.ts`
- **Blocks:** `buildUnifiedOptionsScannerBlocks()` â€” header â†’ ğŸ”¥ Key Recommendations (section) â†’ ğŸ”´ Scanner errors (section when present) â†’ actions (View Dashboard button when `NEXT_PUBLIC_APP_URL` set). No delivery stats or context line in Slack.
- **Fallback:** `formatUnifiedOptionsScannerReport()` returns `bodyText` (plain mrkdwn for notifications/X/UI) and `slackBlocks`; scheduler sends `{ text, blocks }` to Slack when blocks present.

## Exceptions
- Plain mrkdwn acceptable only for internal/debug messages

Apply consistently. Generate clean, valid Block Kit JSON with deep links and risk indicators where appropriate.
