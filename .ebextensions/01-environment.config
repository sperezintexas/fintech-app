# AWS Elastic Beanstalk Environment Configuration
# Uses t3.micro (cheapest tier) for cost optimization

option_settings:
  # Instance configuration - cheapest tier
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.micro
    IamInstanceProfile: aws-elasticbeanstalk-ec2-role

  # Auto-scaling settings - single instance for cost savings
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 1

  # Environment variables (override in EB console or with eb setenv)
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    PORT: 3000
    NEXT_TELEMETRY_DISABLED: 1
    NODE_OPTIONS: --no-deprecation

  # Health check settings
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /api/health
    HealthCheckInterval: 30
    HealthCheckTimeout: 5
    HealthyThresholdCount: 2
    UnhealthyThresholdCount: 3

  # Load balancer (use Application LB for HTTP/HTTPS)
  aws:elasticbeanstalk:environment:
    LoadBalancerType: application
    ServiceRole: aws-elasticbeanstalk-service-role

  # Deployment policy - rolling for zero-downtime
  aws:elasticbeanstalk:command:
    DeploymentPolicy: Rolling
    BatchSizeType: Percentage
    BatchSize: 100

  # CloudWatch logs
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 7
