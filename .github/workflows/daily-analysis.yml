name: Daily Watchlist Analysis

on:
  # Run at 4:00 PM EST (21:00 UTC) Monday-Friday (market close)
  schedule:
    - cron: '0 21 * * 1-5'
  # Allow manual trigger
  workflow_dispatch:

jobs:
  run-analysis:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Daily Analysis
        run: |
          curl -X GET \
            "${{ secrets.APP_URL }}/api/cron/daily-analysis?secret=${{ secrets.CRON_SECRET }}" \
            -H "Accept: application/json" \
            --fail-with-body
        env:
          APP_URL: ${{ secrets.APP_URL }}
          CRON_SECRET: ${{ secrets.CRON_SECRET }}

      - name: Log Success
        if: success()
        run: echo "Daily analysis completed successfully at $(date)"

      - name: Log Failure
        if: failure()
        run: echo "Daily analysis failed at $(date)"
